"use strict";angular.module("dashboardApp",["chart.js","daterangepicker"]).config(["$interpolateProvider",function(a){a.startSymbol("[["),a.endSymbol("]]")}]),angular.module("dashboardApp").controller("VisitsChartCtrl",["$scope","$timeout","$log","$http",function(a,t,e,r){a.init=function(){var t=(moment(),moment().subtract(6,"days")),e=moment().subtract(0,"days");a.date={startDate:t,endDate:e},console.log(a.date),a.opts={format:"DD-MM-YYYY",timePicker:!1,startDate:t,endDate:e,maxDate:"12/31/2015",ranges:{"Últims 7 dies":[moment().subtract(6,"days").format("DD-MM-YYYY"),moment().format("DD-MM-YYYY")],"Últims 30 dies":[moment().subtract(29,"days").format("DD-MM-YYYY"),moment().format("DD-MM-YYYY")],"Aquest mes":[moment().startOf("month").format("DD-MM-YYYY"),moment().endOf("month").format("DD-MM-YYYY")],"Últim mes":[moment().subtract(1,"month").startOf("month").format("DD-MM-YYYY"),moment().subtract(1,"month").endOf("month").format("DD-MM-YYYY")]},opens:"right",drops:"down",locale:{applyLabel:"Guardar",cancelLabel:"Cancel·lar",fromLabel:"Desde",toLabel:"Fins",customRangeLabel:"Personalitzat",daysOfWeek:["dl","dt","dc","dj","dv","ds","dj"],monthNames:["gener","febrer","març","abril","maig","juny","juliol","agost","setembre","octubre","novembre","desembre"],firstDay:1}},moment.locale("ca"),a.chart.draw(t.format("DD-MM-YYYY"),e.format("DD-MM-YYYY"))},a.transformDatesAndUpdateChart=function(){console.log(a.date);var t=moment(a.date.startDate).format("DD-MM-YYYY"),e=moment(a.date.endDate).format("DD-MM-YYYY");a.chart.draw(t,e)},a.chart={draw:function(t,e){r.get(Routing.generate("api_get_visits",{startOn:t,endOn:e})).success(function(t){"day"==t.type?a.chart.drawByDay(t.data):"week"==t.type?a.chart.drawByWeek(t.data):"month"==t.type?a.chart.drawByMonth(t.data):"year"==t.type&&a.chart.drawByYear(t.data)})},drawByDay:function(t){a.labels=[],a.series=[];var e=[];angular.forEach(t,function(t){var r=moment(t.date,"YYYYMMDD").format("dddd DD MMMM");e.push(t.value),a.labels.push(r)}),a.series=["Visites"],a.data=[e]},drawByWeek:function(t){a.labels=[],a.series=[];var e=[];angular.forEach(t,function(t){var r=moment().day(1).week(t.date).format("DD-MM"),o=moment().day(7).week(t.date).format("DD-MM");a.labels.push(r+" a "+o),e.push(t.value)}),a.series=["Visites"],a.data=[e]},drawByMonth:function(t){a.labels=[],a.series=[];var e=[];angular.forEach(t,function(t){var r=moment(t.date,"YYYYMM").format("MMMM YYYY");e.push(t.value),a.labels.push(r)}),a.series=["Visites"],a.data=[e]},drawByYear:function(t){a.labels=[],a.series=[];var e=[];angular.forEach(t,function(t){var r=moment(t.date,"YYYY").format("YYYY");e.push(t.value),a.labels.push(r)}),a.series=["Visites"],a.data=[e]}}}]),angular.module("dashboardApp").controller("ParticipationChartCtrl",["$scope","$timeout","$log","$http",function(a,t,e,r){a.init=function(){var t=(moment(),moment().subtract(6,"day")),e=moment().subtract(0,"day");a.date={startDate:t,endDate:e},a.opts={format:"DD-MM-YYYY",timePicker:!1,startDate:t,endDate:e,maxDate:"12/31/2015",ranges:{"Últims 7 dies":[moment().subtract(6,"days").format("DD-MM-YYYY"),moment().format("DD-MM-YYYY")],"Últims 30 dies":[moment().subtract(29,"days").format("DD-MM-YYYY"),moment().format("DD-MM-YYYY")],"Aquest mes":[moment().startOf("month").format("DD-MM-YYYY"),moment().endOf("month").format("DD-MM-YYYY")],"Últim mes":[moment().subtract(1,"month").startOf("month").format("DD-MM-YYYY"),moment().subtract(1,"month").endOf("month").format("DD-MM-YYYY")]},opens:"right",drops:"down",locale:{applyLabel:"Guardar",cancelLabel:"Cancel·lar",fromLabel:"Desde",toLabel:"Fins",customRangeLabel:"Personalitzat",daysOfWeek:["dl","dt","dc","dj","dv","ds","dj"],monthNames:["gener","febrer","març","abril","maig","juny","juliol","agost","setembre","octubre","novembre","desembre"],firstDay:1}},moment.locale("ca"),a.chart.draw(t.format("DD-MM-YYYY"),e.format("DD-MM-YYYY"))},a.transformDatesAndUpdateChart=function(){var t=moment(a.date.startDate).format("DD-MM-YYYY"),e=moment(a.date.endDate).format("DD-MM-YYYY");a.chart.draw(t,e)},a.chart={draw:function(t,e){r.get(Routing.generate("api_get_participation",{startOn:t,endOn:e})).success(function(t){"day"==t.type?a.chart.drawByDay(t.data):"week"==t.type?a.chart.drawByWeek(t.data):"month"==t.type?a.chart.drawByMonth(t.data):"year"==t.type&&a.chart.drawByYear(t.data)})},drawByDay:function(t){a.labels=[],a.series=[];var e=[],r=[],o=[],s=[];angular.forEach(t,function(t){var n=moment(t.date,"YYYYMMDD").format("dddd DD MMMM");e.push(t.comments),r.push(t.votes),o.push(t.proposals),s.push(t.total),a.labels.push(n)}),a.series=["Comentaris","Vots","Núm. Digues la teva","Total"],a.data=[e,r,o,s]},drawByWeek:function(t){a.labels=[],a.series=[];var e=[],r=[],o=[],s=[];angular.forEach(t,function(t){var n=moment().day(1).week(t.date).format("DD-MM"),m=moment().day(7).week(t.date).format("DD-MM");a.labels.push(n+" a "+m),e.push(t.comments),r.push(t.votes),o.push(t.proposals),s.push(t.total)}),a.series=["Comentaris","Vots","Núm. Digues la teva","Total"],a.data=[e,r,o,s]},drawByMonth:function(t){a.labels=[],a.series=[];var e=[],r=[],o=[],s=[];angular.forEach(t,function(t){var n=moment(t.date,"YYYYMM").format("MMMM YYYY");a.labels.push(n),e.push(t.comments),r.push(t.votes),o.push(t.proposals),s.push(t.total)}),a.series=["Comentaris","Vots","Núm. Digues la teva","Total"],a.data=[e,r,o,s]},drawByYear:function(t){a.labels=[],a.series=[];var e=[],r=[],o=[],s=[];angular.forEach(t,function(t){var n=moment(t.date,"YYYY").format("YYYY");a.labels.push(n),e.push(t.comments),r.push(t.votes),o.push(t.proposals),s.push(t.total)}),a.series=["Comentaris","Vots","Núm. Digues la teva","Total"],a.data=[e,r,o,s]}}}]);